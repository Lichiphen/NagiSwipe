<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NagiSwipe Demo</title>
    <!-- 
      NagiSwipe Integration Example 
      Just load these two files.
    -->
    <script>
        /**
         * 外部ファイルの最終更新日時を取得してキャッシュバスターとして付与し、
         * タグを動的に生成してロードするスクリプト
         */
        (function() {
            function loadAsset(url, type) {
                const xhr = new XMLHttpRequest();
                // 同期リクエストでHEADのみ取得（メタデータ確認のため）
                xhr.open('HEAD', url, false);
                try {
                    xhr.send();
                    const lastMod = xhr.getResponseHeader('Last-Modified');
                    // メタデータ（日時）をパスに変換、取得できなければ現在時刻
                    const version = lastMod ? encodeURIComponent(lastMod) : Date.now();
                    const finalUrl = `${url}?v=${version}`;

                    if (type === 'css') {
                        const link = document.createElement('link');
                        link.rel = 'stylesheet';
                        link.href = finalUrl;
                        document.head.appendChild(link);
                    } else if (type === 'js') {
                        const script = document.createElement('script');
                        script.src = finalUrl;
                        // ライブラリなので早期に読み込ませる
                        document.head.appendChild(script);
                    }
                } catch (e) {
                    console.error('Failed to fetch metadata for ' + url, e);
                    // 失敗した場合は通常の読み込みを試行
                    if (type === 'css') document.write(`<link rel="stylesheet" href="${url}">`);
                    else document.write(`<script src="${url}"><\/script>`);
                }
            }

            // CSSとJSをメタデータ付きでロード
            loadAsset('NagiSwipe-main.css', 'css');
            loadAsset('NagiSwipe-main.js', 'js');
        })();
    </script>
    
    <style>
        /* [DEMO PAGE CSS] */
        *, *::before, *::after { box-sizing: border-box; }
        body {
            margin: 0; padding: 0; background-color: #000; color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow-x: hidden; -webkit-tap-highlight-color: transparent; overscroll-behavior: none;
        }
        .gallery-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; padding: 2px;
            opacity: 0; will-change: opacity; transition: opacity 0.4s ease-out; padding-bottom: 50px;
        }
        @media (min-width: 600px) {
            .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 4px; padding: 40px; }
        }
        .gallery-link {
            display: block; width: 100%; height: 100%; text-decoration: none; color: inherit; position: relative;
        }
        .grid-item {
            position: relative; background: #1a1a1a; aspect-ratio: 1 / 1; overflow: hidden;
            cursor: zoom-in; opacity: 0; transform: scale(0.95); transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .grid-item.loaded { opacity: 1; transform: scale(1); }
        .grid-item img {
            width: 100%; height: 100%; object-fit: cover; display: block; pointer-events: none; will-change: transform;
        }
    </style>
</head>
<body>

    <!-- Gallery Grid -->
    <div class="gallery-grid" id="grid"></div>

    <!-- Core Library is now loaded dynamically in head -->
    
    <!-- Demo Script -->
    <script>
        /** [DEMO CONTENT GENERATION] */
        const itemsData = [];
        const container = document.getElementById('grid');
        const fragment = document.createDocumentFragment();

        for (let i = 0; i < 30; i++) {
            const el = document.createElement('div');
            el.className = 'grid-item';

            const link = document.createElement('a');
            link.className = 'gallery-link';

            const seed = i + 3000;
            let w = 800, h = 800;
            const r = Math.random();
            if (r < 0.3) { w = 600; h = 900; }
            else if (r < 0.6) { w = 900; h = 600; }

            const src = `https://picsum.photos/seed/${seed}/${w}/${h}`;
            const fullSrc = `https://picsum.photos/seed/${seed}/${w * 2}/${h * 2}`;

            link.href = fullSrc + ".jpg"; 

            const img = document.createElement('img');
            img.src = src;
            
            link.appendChild(img);
            el.appendChild(link);
            fragment.appendChild(el);
        }
        container.appendChild(fragment);

        requestAnimationFrame(() => {
            container.style.opacity = 1;
            Array.from(container.children).forEach((el, i) => {
                setTimeout(() => el.classList.add('loaded'), i * 30);
            });
        });
    </script>
</body>
</html>